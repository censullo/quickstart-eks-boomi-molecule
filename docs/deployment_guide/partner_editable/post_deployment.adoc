// Include any postdeployment steps here, such as steps necessary to test that the deployment was successful. If there are no postdeployment steps, leave this file empty.

== Postdeployment steps

=== Test the deployment
To view the Molecule in Boomi AtomSphere, log in to your https://platform.boomi.com/[Boomi account^]. On the *Manage* menu, choose *Atom Management*.

[#AddInfo1]
.Boomi Dashboard with an unattached AWS-managed Molecule Cluster
[link=images/image3.png]
image::../images/image3.png[image,width=648,height=293]

You can attach Molecules to any environment you have staged and deploy workloads to that Molecule cluster. On the Boomi dashboard, your deployed Molecule is under *Unattached Atoms*. For more information, refer to https://help.boomi.com/bundle/integration/page/t-atm-Attaching_an_Atom_to_an_Enviro.html[Attaching an Atom to or detaching an Atom from an environment^].

=== Security
This Quick Start deploys a Boomi Molecule EKS cluster into the private subnets of an AWS managed VPC. It cannot be reached through the internet. The cluster communicates through a NAT gateway in the public subnet for updates and patches, and through a public-facing Network Load Balancer to Boomi AtomSphere. You can only access the cluster at a command-line level through the bastion host in the public subnet.

=== Performance monitoring

Monitoring the CPU, network, and Amazon Elastic Block Store (Amazon EBS) performance of your cluster is done through CloudWatch metrics. CPU and network performance are measured in utilization, network in and out, network packets in and out, and system status checks. Amazon EBS volume performance is measured in read and write throughput, average read and write size, read and write bandwidth, read and write latency, and volume idle time. Amazon EFS reports metrics to CloudWatch and can be monitored there. Metrics include client connections, data read and data write bytes, and I/O percent limits.

=== Creating an installation token

Administrators can create an installation token without having to share login credentials for an Atom/Molecule installation.

. On the *Manage* menu, choose *Atom Management*.
. Choose *New, Molecule*.
. On the *Build* page, choose the *Welcome* tab.
. Under the *Create* heading, choose *Molecule*.
. Choose *Security Options*.
. For *Token Valid for*, select the length of time the token is valid (30 minutes to 24 hours).
. Click *Generate Token*.

[#AddInfo2]
.Molecule Setup
[link=images/image6.png]
image::../images/image6.png[image,width=402,height=319]

=== Creating an API token

Administrators can create a long-lived API token without having to share Boomi login credentials.

. On the *Settings* menu, choose *Account Information and Setup*.
. Choose the *AtomSphere API Tokens* tab.
. Choose *Add New Token*.

[start=4]
. Enter a unique name for the token.

[#AddInfo3]
.New AtomSphere API Token
[link=images/image9.png]
image::../images/image9.png[image,width=370,height=219]

[start=5]
. Choose *Generate Token*.
. Choose *Copy* to copy the token string to the clipboard without exiting. When you are ready to exit, click *Copy to Clipboard & Close* to copy the token string and exit the dialog.

[#AddInfo4]
.Copying the token string
[link=images/image10.png]
image::../images/image10.png[image,width=370,height=219]

NOTE: Copy the token key value to a secure location. It is recommended that you treat tokens with the same level of security as you would a password. If you lose it, you will have to generate a new token and revoke the old one.

== Additional information

=== Bastion host, pod autoscaling, and node autoscaling
The Amazon EKS Quick Start deploys the following:

* A virtual bastion host for an administrator to run Kubectl commands against the Kubernetes cluster.

* Kubernetes horizontal pod autoscaling with target CPU utilization of 60%. This automatically scales pods if average pod utilization exceeds 60%.

* Three nodes in the Auto Scaling group (the maximum capacity). To automatically scale the nodes, we need to increase the maximum capacity values.

=== Upgrade Boomi Molecule Docker image

To upgrade the Boomi Molecule image, complete the following steps.

. Log in to the bastion host.
. Run the following Kubectl command.
+
`kubectl get statefulset -n eks-boomi-molecule -o yaml > statefulset.yaml`

. Edit `statefulset.yaml` and update the Boomi Molecule image.
. Run the following Kubectl command. This will invoke a rolling restart of the StatefulSet.
+
`kubectl apply -f statefulset.yaml -n eks-boomi-molecule`

=== Apply SSL certificate to the load balancers

Follow the instructions in this section to add listeners to the Application Load Balancer and Network Load Balancer.

==== Application Load Balancer

. https://docs.aws.amazon.com/elasticloadbalancing/latest/application/create-https-listener.html#add-https-listener[Add an HTTPS listener^] for your Application Load Balancer.
.. For *Protocol : port*, select *HTTPS*.
.. For *Default actions*, select *Forward to*, then select the target group.

. https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html#working-with-security-group-rules[Add an inbound rule^] to the security group attached to the Application Load Balancer.
.. For rule *Type*, choose *HTTP*.
.. For rule *Source*, choose *Anywhere-IPv4*. This automatically adds a rule for the `0.0.0.0/0 IPv4` CIDR block.
. https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resource-record-sets-creating.html[Add a new A record^] to your domain in Amazon Route 53.
. https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resource-record-sets-editing.html[Edit the record name^].
. https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-to-elb-load-balancer.html#routing-to-elb-load-balancer-configuring[Route traffic^] to the Application Load Balancer.

==== Network Load Balancer

. https://docs.aws.amazon.com/elasticloadbalancing/latest/network/create-listener.html[Create a listener^] for your Network Load Balancer.
.. For *Protocol : port*, select *TLS*.
.. For *Default actions*, select *Forward to*, then select the target group.

. https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resource-record-sets-creating.html[Add a new A record^] to your domain in Amazon Route 53.
. https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/resource-record-sets-editing.html[Edit the record name^].
. https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/routing-to-elb-load-balancer.html#routing-to-elb-load-balancer-configuring[Route traffic^] to the Network Load Balancer.

